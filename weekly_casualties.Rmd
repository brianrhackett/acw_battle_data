---
title: "Weekly Casualties in the American Civil War: Analysis of Greer's Data"
author: "Jeffrey B. Arnold"
date: "05/21/2015"
output: html_document
---

```{r}
library('readr')
library("tidyr")
library("ggplot2")
library("dplyr")
IGNORE <- c("attrition",
            "Jefferson Davis captured - May 10",
            "Johnston surrenders - April 26",
            "Taylor surrenders - May 4",
            "Buckner surrenders - May 26",
            "Stand Waite surrenders - June 23",
            "Ellsworth's death")
casualties <- read_csv("~/Documents/research/acw_battle_data/data/greer2005//greer2005_weekly_casualties.csv") %>%
  filter(! description %in% IGNORE)

all_sundays_theater <- expand.grid(date = seq(min(casualties$date), max(casualties$date),
                                     by = "week"),
                                  theater = unique(casualties$theater))

all_sundays <- data.frame(date = seq(min(casualties$date), max(casualties$date),
                                     by = "week")
  
fill_na <- function(x, fill = 0) {
  x[is.na(x)] <- fill
  x
}

casualties_week <- casualties %>%
  group_by(date) %>%
  summarise(confederate = sum(confederate),
            union = sum(union)) %>%
  merge(all_sundays, by = "date", all.y = TRUE) %>%
  mutate(confederate = fill_na(confederate),
         union = fill_na(union))
  
ggplot(gather(casualties_week, belligerent, casualties, - date) %>%
         filter(casualties > 0),
       aes(x = casualties, fill = belligerent)) + 
  geom_histogram(alpha = 0.2)

casualties_week_theater <- casualties %>%
  group_by(date, theater) %>%
  summarise(confederate = sum(confederate),
            union = sum(union)) %>%
  merge(all_sundays_theater, by = c("date", "theater"), all.y = TRUE) %>%
  mutate(confederate = fill_na(confederate),
         union = fill_na(union))

ggplot(gather(casualties_week_theater, belligerent, casualties, - date, - theater) %>%
         filter(casualties > 0),
       aes(x = sqrt(casualties), fill = belligerent)) + 
  geom_histogram(alpha = 0.2) +
  facet_wrap(~ theater, nrow = 2)

```

